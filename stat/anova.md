# 方差分析

## 简介

方差分析的基本原理是认为不同处理组的均值差别基本来源有两个：

1. 随机误差，如测量误差造成的差异或个体间的差异，称为组内差异，用变量在各组的均值与该组内变量值的差值的平方和的总和表示， 记作 $SSw$，组内自由度 $dfw$
2. 实验条件，即不同的处理造成的差异，称为组间差异。用变量在各组的均值与总均值之偏差平方和表示，记作SSb，组间自由度dfb。

## 单因素方差分析

双样本均值比较可使用成组的独立样本 t 检验。对于多组样本的均值检验，**零假设**是这些多组样本来自同一总体，各组的均值相等，**备择假设**是平均数并不都相等，存在两对或多对样本的均值不相等，这种情况可以采用单因素多水平的方差分析。

方差分析的原理是检验多组样本的平均数的方差是否足够大，如果多组样本来自同一个总体，不同组平均数的差异是随机产生的，那么组间平方和接近于随机误差产生的平方和；反之，组间平方和过大可以说明存在处理效应，即这几组样本来自不同总体。

单因素方差分析是针对(单个因素 a 个水平(或处理)下得到的样本数据)进行的分析其线性统计模型是:

$$x_{ij}=\mu+\alpha_i+\varepsilon_{ij}, i=1,2,...,a;j=1,2,...,n$$

其中：

- $\mu$ 是总体均值；
- a 是第 i 个水平的相对平均数或相对处理效应；
- $\varepsilon_{ij}$ 是随机误差，独立且服从正态分布；
- a 是水平的数目；
- n 是每个水平下的样本数目，在这里每个水平有相等数目的样本数，也称平衡设计。

方差分析的零假设是 $\alpha_i=0$ 或者 $\alpha_i$ 的方差为 0，变量的平方和可以分解为处理平方和(也称组间平方和)和误差平方和，分别除以各自的自由度得到处理均方和误差均方,它们的比值服从 F 分布，可以使用 F 检验进行判断。

方差分析采用函数 `aov()`，它调用 `lm() `函数进行线性模型的合，与直接调用 `lm()` 的区别在于拟合结果的输出方式不同。因此,也可以使用 `lm()` 和 `anova()` 函数联合进行方差分析。

```r
aov(formula, data = NULL, projections = FALSE, qr = TRUE,
    contrasts = NULL, …)
```



## 参考

- 概率论与数理统计-陈希孺
- https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/aov