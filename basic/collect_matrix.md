# 矩阵

2024-09-04 ⭐
@author Jiawei Mao
***

## 简介

矩阵，实际上是一个长向量，只是在 R 内部处理时，作为多维分析。即矩阵是有维数的向量，矩阵**元素类型需一致**，可以是数值型、字符型或逻辑型。

## 创建矩阵

`matrix` 函数使用指定值创建矩阵：

```r
matrix(data = NA, nrow = 1, ncol = 1, byrow = FALSE,
       dimnames = NULL)
```

|参数|说明|
|---|---|
|`data`|提供数据的列表或向量|
|`nrow`|行数|
|`ncol`|列数|
|`byrow`|是否按行填充。`FALSE` 表示按列填充矩阵，否则按行填充|

- `dimnames`

用于指定矩阵的行和列名称，`NULL` 或长度为 2 的列表。

- list 长度为 0 等价于 NULL
- list 长度为 1 对应行名
- list 也可以包含名称，对应 dimension 名称

例如：指定 `nrow`，`ncol` 自然确定

```R
> die <- c(1,2,3,4,5,6)
> m <- matrix(die, nrow=2)
> m
     [,1] [,2] [,3]
[1,]    1    3    5
[2,]    2    4    6
```

- `matrix` 默认按 column 填充，设置 `byrow = TRUE` 表示按 row 填充

```r
> m <- matrix(c(2, 4, 6, 1, 3, 8), nrow = 2, ncol = 3, byrow = TRUE)
> m
     [,1] [,2] [,3]
[1,]    2    4    6
[2,]    1    3    8
```

```r
> matrix(c(1, 2, 3, 4, 5, 6), nrow = 2, ncol = 3) # 矩阵，默认按列填充
     [,1] [,2] [,3]
[1,]    1    3    5
[2,]    2    4    6
> matrix(c(1, 2, 3, 4, 5, 6), nrow = 2, ncol = 3, byrow=TRUE) # 设置按行填充
     [,1] [,2] [,3]
[1,]    1    2    3
[2,]    4    5    6
> matrix(c(1, 2, 3, 4, 5, 6), nrow = 2, ncol = 3, dimnames = list(c("R1", "R2"), c("C1", "C2", "C3"))) # 设置行和列的名称
   C1 C2 C3
R1  1  3  5
R2  2  4  6
```

- 创建空矩阵，然后赋值

```r
> y <- matrix(nrow = 2, ncol = 2)
> y[1,1] <- 1
> y[2,1] <- 2
> y[1,2] <- 3
> y[2,2] <- 4
> y
     [,1] [,2]
[1,]    1    3
[2,]    2    4
```

### as.matrix

`as.matrix` 尝试将其参数转换为矩阵。

```r
as.matrix(x, ...)
## S3 method for class 'data.frame'
as.matrix(x, rownames.force = NA, ...)
```

### is.matrix

`is.matrix` 尝试参数是否为矩阵。

```r
is.matrix(x)
```

## 索引

对矩阵 `A`：

- `A[2, 3]` 选择第2行第3列元素；
- `A[i,]` 取第 i 行元素；
- `A[,j]` 取第 j 列元素。

如果使用向量作为索引，可以一次选择多行、多列。例如：

```r
> A <- matrix(1:16, 4, 4)
> A
     [,1] [,2] [,3] [,4]
[1,]    1    5    9   13
[2,]    2    6   10   14
[3,]    3    7   11   15
[4,]    4    8   12   16
> A[c(1,3), c(2, 4)] # 选择1，3行，2，4列
     [,1] [,2]
[1,]    5   13
[2,]    7   15
> A[1:3, 2:4] # 选择1-3行，2-4列
     [,1] [,2] [,3]
[1,]    5    9   13
[2,]    6   10   14
[3,]    7   11   15
> A[1:2, ] # 选择1-2行，所有列
     [,1] [,2] [,3] [,4]
[1,]    1    5    9   13
[2,]    2    6   10   14
> A[, 1:2] # 选择所有行，1-2列
     [,1] [,2]
[1,]    1    5
[2,]    2    6
[3,]    3    7
[4,]    4    8
```

### 删除元素

带 `-` 索引用于删除对应位置的元素。例如：

```r
> A[-c(1,3),] # 删除1，3行
     [,1] [,2] [,3] [,4]
[1,]    2    6   10   14
[2,]    4    8   12   16
> A[-c(1,3),-c(1,3,4)] # 删除1,3行，1,3,4列
[1] 6 8
> A
     [,1] [,2] [,3] [,4]
[1,]    1    5    9   13
[2,]    2    6   10   14
[3,]    3    7   11   15
[4,]    4    8   12   16
```

该操作返回一个新的矩阵，不影响原矩阵。

定义矩阵

```r
> x <- matrix(c(1, 2, 3, 4, 5, 6), nrow=2, ncol=3)
> x
     [,1] [,2] [,3]
[1,]    1    3    5
[2,]    2    4    6
```

- 去掉行或列

```r
> x[-1,] # 去掉第1行
[1] 2 4 6
> x[,-2] # 去掉第2列
     [,1] [,2]
[1,]    1    5
[2,]    2    6
```

- 添加或替换元素

```r
> x[,3] <- NA # 第3列设置为 NA
> x
     [,1] [,2] [,3]
[1,]    1    3   NA
[2,]    2    4   NA
> x[is.na(x)] <- 1 # 将 NA 替换为1
> x
     [,1] [,2] [,3]
[1,]    1    3    1
[2,]    2    4    1
```

## 矩阵操作

```r
> a <- matrix(1:9, nrow = 3)
> a
     [,1] [,2] [,3]
[1,]    1    4    7
[2,]    2    5    8
[3,]    3    6    9
```

取第1行和第二行的 2-3 列，用 `[1:2, 2:3]`，得到一个新的矩阵：

```r
> a[1:2, 2:3]
     [,1] [,2]
[1,]    4    7
[2,]    5    8
```

`[` 默认将获取的数据尽可能以低的维度呈现，比如：

```r
> a[1, 1:2]
[1] 1 4
```

表示第一行的前两列，此时不是 $1\times2$矩阵，而是包含两个元素的向量。

保留所有的行或列，例如选取1到2行的所有列，可以如下简写：

```r
> a[1:2, ]
     [,1] [,2] [,3]
[1,]    1    4    7
[2,]    2    5    8
```

即，省略掉对应位置的索引即可。

### 对角矩阵

`diag(m)` 返回矩阵的对角元。

```r
> diag(1:4)
     [,1] [,2] [,3] [,4]
[1,]    1    0    0    0
[2,]    0    2    0    0
[3,]    0    0    3    0
[4,]    0    0    0    4
> A <- matrix(1:16, 4, 4)
> A
     [,1] [,2] [,3] [,4]
[1,]    1    5    9   13
[2,]    2    6   10   14
[3,]    3    7   11   15
[4,]    4    8   12   16
> diag(A)
[1]  1  6 11 16
```

### 单位矩阵

```r
> diag(4)
     [,1] [,2] [,3] [,4]
[1,]    1    0    0    0
[2,]    0    1    0    0
[3,]    0    0    1    0
[4,]    0    0    0    1
```

### 矩阵信息查询

- 矩阵维度

```r
> dim(A)
[1] 4 4
```

- 矩阵行数

```r
> nrow(A)
[1] 4
```

- 矩阵列数

```r
> ncol(A)
[1] 4
```

### 矩阵合并

```r
> m1 <- matrix(1, nrow=2, ncol=2)
> m2 <- matrix(2, nrow=2, ncol=2)
> rbind(m1, m2) # 按行合并
     [,1] [,2]
[1,]    1    1
[2,]    1    1
[3,]    2    2
[4,]    2    2
> cbind(m1, m2) # 按列合并
     [,1] [,2] [,3] [,4]
[1,]    1    1    2    2
[2,]    1    1    2    2
```

- 逐元乘积

各个对应位置的元素相乘。

```r
> m1 * m2
     [,1] [,2]
[1,]    2    2
[2,]    2    2
```

- 方阵的行列式

```r
> det(m2)
[1] 0
```

- 矩阵的代数乘积

%*%

```r
> m1 %*% m2
     [,1] [,2]
[1,]    4    4
[2,]    4    4
```
